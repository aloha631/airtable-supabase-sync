---
stepsCompleted: [1, 2, 3, 4]
inputDocuments: []
workflowType: 'prd'
lastStep: 4
briefCount: 0
researchCount: 0
brainstormingCount: 0
projectDocsCount: 0
---

# Product Requirements Document - airtable syc to Supabase

**Author:** Liaosanyi
**Date:** 2026-01-01

## Executive Summary

**airtable syc to Supabase** 是一個資料自主權專案，透過建立自動化同步系統將Airtable的20,000筆資料持續複製到自主掌控的Supabase（PostgreSQL）資料庫，為未來的自動化流程遷移和完全資料獨立奠定基礎。

### 核心問題

目前所有重要資料和100個自動化流程完全依賴Airtable，面臨資料自主權和長期擴展性的限制：

1. **資料自主權缺失**
   - 20,000筆業務關鍵資料完全存放在第三方專有平台
   - 無法完全掌控資料的存取、格式和遷移自由
   - 依賴Airtable的商業決策、定價策略和服務條款
   - 資料導出和備份需要手動操作

2. **自動化流程生態系統鎖定**
   - 100個Make.com和n8n自動化流程（涵蓋所有工作）完全綁定Airtable API
   - 50個流程執行讀取操作，50個流程執行寫入操作
   - 每15分鐘執行週期，對Airtable API依賴度極高
   - 無法使用開源工具和標準SQL進行複雜資料分析
   - 擴展性和靈活性受限於Airtable生態系統

3. **長期策略風險**
   - 缺乏獨立的資料存取管道和備份機制
   - Airtable服務中斷會導致所有自動化流程停擺
   - 未來若需要遷移，成本和風險極高
   - 無法自由選擇和整合其他工具和服務

### 解決方案願景

建立**漸進式資料自主策略**，透過自動同步機制將Airtable資料持續複製到自主掌控的Supabase資料庫：

**Phase 1（0-3個月）：建立基礎 - 資料備份與API準備**

- **自主資料庫：** 在Supabase建立完整的PostgreSQL資料副本
- **自動同步：** 每小時自動同步（Airtable → Supabase），資料延遲最多1小時
- **風險隔離：** Airtable繼續作為主要編輯介面，100個自動化流程維持不變
- **API就緒：** Supabase提供REST/GraphQL API，隨時可供未來使用
- **資料自主：** 擁有完全掌控的PostgreSQL資料庫，可隨時導出、備份、分析

**Phase 2（3-6個月，選擇性）：漸進式流程遷移**

- **低風險遷移：** 逐步將「讀取」流程從Airtable API遷移到Supabase API
- **負載分散：** 減輕Airtable API負擔，提升系統穩定性
- **學習階段：** 累積Supabase使用經驗，驗證長期可行性
- **彈性調整：** 可隨時暫停或調整遷移速度
- **維持穩定：** 「寫入」流程繼續使用Airtable，保持資料一致性

**Phase 3（6個月後，遠期評估）：完全獨立（需審慎評估）**

- **條件評估：** 若成功建立合適的Supabase UI介面
- **完全遷移：** 考慮從Airtable完全遷移到Supabase
- **務實決策：** 若UI成本過高，維持混合模式（Airtable編輯 + Supabase API）

### 成功標準

**Phase 1 核心指標（0-3個月）：**

1. **資料完整性：100%**
   - 所有20,000筆記錄成功同步
   - Rich text內容（Markdown格式，最多10,000字元/筆）完整保留
   - 所有連結資料正確解析和儲存
   - 繁體中文、特殊符號、emoji正確處理（UTF-8編碼）

2. **同步可靠性**
   - 每小時自動執行同步（資料時效性：最多1小時落差）
   - 連續1個月同步成功率 ≥ 99%
   - 失敗時自動重試機制（指數退避）
   - 同步狀態可追蹤和監控

3. **系統穩定性**
   - Airtable和100個自動化流程完全不受影響（零風險）
   - Supabase作為「影子系統」，失敗不影響正常工作
   - 提供健康檢查端點和告警機制

4. **基本可用性**
   - 能熟練使用Supabase Table Editor查詢和瀏覽資料
   - 完成至少1次成功的災難演練（模擬Airtable當機，使用Supabase工作1-2小時）
   - 建立對備份系統的信任感

5. **Phase 1 完成標準**
   - ✅ 連續1個月同步成功率 ≥ 99%
   - ✅ 資料完整性驗證100%通過
   - ✅ 至少完成1次成功的災難演練
   - ✅ 同步監控和告警系統正常運作
   - ✅ 使用者能自信地使用Supabase查詢資料

**Phase 2 目標（選擇性，3-6個月）：**

6. **流程遷移進度**
   - 成功遷移5-10個「讀取」流程到Supabase API
   - 遷移流程的穩定性驗證（運行30天無問題）
   - Make.com/n8n模組配置文檔完整

7. **效能驗證**
   - Supabase API回應時間 < 500ms（95百分位）
   - 並發查詢處理能力滿足需求
   - 複雜查詢（JOIN、聚合）效能可接受

### 風險緩解策略

**Phase 1 關鍵風險與對策：**

1. **資料完整性風險**
   - **風險：** 同步過程中資料遺失、截斷或格式錯亂（特別是繁體中文、特殊符號、emoji）
   - **對策：**
     - 每次同步後自動驗證筆數對比
     - 隨機抽樣5%資料進行內容完整性檢查
     - PostgreSQL正確配置為UTF-8編碼
     - 建立「黃金資料集」（包含中文、特殊符號、長文、emoji）進行端到端測試
     - 實作同步歷史記錄和回滾機制

2. **靜默失敗風險**
   - **風險：** 同步失敗但無告警，資料逐漸過期而不自知
   - **影響：** Phase 1影響較小（Airtable照常運作），但影響信任建立
   - **對策：**
     - 實作即時告警系統（Email通知）
     - 建立簡單的同步狀態記錄（最後同步時間、成功/失敗、資料筆數）
     - 連續3次同步失敗立即發送緊急通知
     - 每週人工檢查同步狀態

3. **技術債務風險**
   - **風險：** Airtable API速率限制、分頁處理、重試邏輯未正確實作
   - **對策：**
     - 實作指數退避重試機制
     - 正確處理Airtable分頁API（每頁最多100筆）
     - 監控API速率限制（每秒5次請求）並實作延遲機制
     - Rich text轉換後進行格式驗證

4. **Phase 2 流程遷移風險**（未來）
   - **風險：** 遷移Make.com/n8n流程時配置錯誤或資料不一致
   - **對策：**
     - 複製流程進行測試，不直接修改生產流程
     - 小批次遷移（每次5-10個流程）
     - 每個流程遷移後運行30天驗證期
     - 保留Airtable版本作為備援

### 目標使用者

**主要使用者：** Liaosanyi（個人使用）

**使用者背景：**
- 使用Airtable管理20,000筆業務關鍵資料
- 運行100個Make.com和n8n自動化流程（涵蓋所有工作）
- 資料包含rich text（約10,000字元/筆）和連結
- 自動化流程每15分鐘執行，包含讀取和寫入操作

**Phase 1 使用情境：**

1. **日常工作（維持現狀）**
   - 繼續在Airtable編輯資料（UI優秀）
   - 100個自動化流程照常運行（零變動）
   - Supabase在背景自動同步（透明化）

2. **資料備份與安心**
   - Supabase提供完整資料備份
   - 隨時可以pg_dump導出資料
   - 不再擔心單一平台依賴

3. **探索和學習**
   - 使用Supabase Table Editor瀏覽資料
   - 學習SQL查詢和PostgreSQL功能
   - 進行複雜資料分析（不影響Airtable）

4. **災難演練**
   - 定期模擬Airtable當機情境
   - 練習使用Supabase查詢資料
   - 建立對備份系統的信任

**Phase 2 使用情境（未來）：**

5. **流程逐步遷移**
   - 將部分「讀取」流程改用Supabase API
   - 減輕Airtable API負擔
   - 驗證Supabase API的穩定性和效能

6. **混合模式運作**
   - Airtable：手動編輯 + 部分流程
   - Supabase：部分流程 + 複雜查詢

### What Makes This Special

這不只是備份工具，而是**漸進式奪回資料和系統掌控權**的長期策略：

1. **從依賴到自主的漸進之路**
   - **Phase 1：** 建立自主資料庫，保持Airtable運作（低風險）
   - **Phase 2：** 漸進遷移流程，累積經驗（可控風險）
   - **Phase 3：** 視情況決定完全獨立（靈活決策）
   - **不是一次性革命，而是持續演進**

2. **務實的風險管理**
   - Phase 1完全不影響現有工作（Airtable照常）
   - Supabase作為「影子系統」，失敗也無妨
   - 有充足時間測試、學習、建立信任
   - 可以隨時暫停或調整策略

3. **為未來鋪路，不急於求成**
   - 現在建立基礎（資料備份 + API準備）
   - 未來有選擇權（遷移流程 or 維持現狀）
   - 時間站在我們這邊（不需要趕時間）
   - 每一步都創造價值（資料自主、備份、學習）

4. **自動化流程生態系統的靈活性**
   - Make.com和n8n原生支援PostgreSQL/Supabase
   - 流程遷移相對簡單（改資料源模組，不改邏輯）
   - 可以混合運作（部分Airtable，部分Supabase）
   - 保留完全的彈性和可逆性

5. **資料真正的自由**
   - PostgreSQL是開放標準，不被任何廠商鎖定
   - 可搭配任何工具（Metabase、Grafana、自建應用）
   - 隨時可以遷移到其他PostgreSQL服務
   - 真正擁有資料的掌控權

## Project Classification

**Technical Type:** 資料同步服務 / API Backend
**Domain:** General
**Complexity:** Medium
**Project Context:** Greenfield - 新專案
**Deployment Environment:** Zeabur雲端平台（預估成本：$7-12/月）
**Development Timeline:** 3個月（Phase 1）

### Phase 1 技術架構（0-3個月）

這是一個後端資料整合專案，核心是建立可靠的**單向同步機制（Airtable → Supabase）**：

**技術挑戰：**

1. **Airtable API整合**
   - 批次讀取20,000筆資料（正確處理分頁，每頁100筆）
   - 遵守API速率限制（每秒5次請求）
   - Rich text欄位解析（Markdown格式保留）
   - 連結資料提取和結構化儲存

2. **資料轉換與驗證**
   - Rich text Markdown解析和格式保留
   - 連結提取和JSONB儲存
   - UTF-8編碼處理（繁體中文、特殊符號、emoji）
   - 同步後資料完整性驗證

3. **Supabase API整合**
   - 批次寫入和更新（使用Supabase JS Client）
   - 增量更新邏輯（只同步變更的資料）
   - PostgreSQL schema設計（TEXT欄位 + JSONB欄位）

4. **排程執行**
   - Zeabur Cron Job配置（每小時觸發）
   - Node.js同步服務（TypeScript開發）
   - 環境變數管理（Airtable API key、Supabase連線）

5. **錯誤處理和重試**
   - 網路失敗重試（指數退避機制）
   - API速率限制處理（延遲和重試）
   - 資料異常處理（格式錯誤、超長文字）

6. **同步狀態追蹤**
   - 記錄同步時間戳
   - 記錄成功/失敗狀態
   - 記錄同步資料筆數
   - 簡單的日誌系統

7. **監控和告警**
   - Email告警（同步失敗通知）
   - 健康檢查端點
   - 基本的同步狀態查詢

8. **部署和運維**
   - Zeabur平台部署
   - 環境配置和secrets管理
   - 日誌查看和除錯

**技術棧：**
- **語言：** Node.js + TypeScript
- **Airtable整合：** Airtable.js SDK
- **Supabase整合：** @supabase/supabase-js
- **排程：** Zeabur Cron Job
- **部署：** Zeabur容器化部署

**品質保證（Phase 1）：**
- 單元測試（API整合、資料轉換邏輯）
- 整合測試（端到端同步流程）
- 黃金資料集測試（繁體中文、特殊符號、長文）
- 本機測試環境（小規模資料驗證）
- 生產環境監控（同步成功率、資料完整性）

### Phase 2 技術考量（未來，3-6個月）

**Make.com/n8n流程遷移：**
- Make.com PostgreSQL模組配置
- n8n Supabase/PostgreSQL節點配置
- 流程複製和測試環境
- 漸進式遷移計畫（每月5-10個流程）

**Supabase效能優化：**
- 索引優化（常用查詢欄位）
- 查詢效能監控
- 連線池配置

## Success Criteria

### User Success（使用者成功）

**Phase 1 使用者成功標準（0-3個月）：**

1. **「值得了」的關鍵時刻**
   - ✅ 第一次成功用Supabase Table Editor查詢資料
   - ✅ 第一次用Claude Code直接讀取Supabase資料進行分析
   - ✅ 第一次用AI工具（Claude、GPT等）與Supabase資料對話
   - ✅ 體驗到「資料自由」的感覺：不受Airtable UI限制，可以用SQL隨意查詢

2. **信任建立**
   - ✅ 連續1個月同步成功率 ≥ 99%（無錯誤運行）
   - ✅ 至少3次隨機抽查，資料與Airtable 100%一致
   - ✅ 完成1次災難演練，成功使用Supabase查詢資料
   - ✅ 內心感受：「即使Airtable當機，我也不擔心」

3. **日常使用體驗**
   - ✅ Supabase同步完全透明化，不干擾日常工作
   - ✅ 100個Make.com/n8n流程照常運行（零影響）
   - ✅ 可以隨時用Supabase進行複雜資料分析（不影響Airtable效能）

**Phase 2 使用者成功標準（3-6個月，選擇性）：**

4. **AI Agent工作流程建立**（這是Phase 2的真正目標）
   - ✅ 建立至少1個AI Agent工作流程（使用Claude/GPT + Supabase資料）
   - ✅ AI Agent能自動查詢、分析、生成洞察
   - ✅ 體驗到「AI與資料對話」的能力（Airtable做不到的）
   - ✅ 不再受限於Airtable的查詢和分析能力

5. **選擇性流程遷移**（非必需）
   - 如果時間允許：遷移5-10個「讀取」流程到Supabase API
   - 如果工作繁忙：維持現狀（Make.com/n8n繼續用Airtable）
   - 保持彈性：可以隨時暫停或調整

### Business Success（業務成功）

**對個人使用者而言，「業務成功」= 「工作效率和自主性」：**

1. **資料自主權達成（3個月內）**
   - ✅ 不再100%依賴Airtable
   - ✅ 擁有完整的PostgreSQL資料副本（可隨時pg_dump導出）
   - ✅ 可以自由選擇工具（不被供應商鎖定）

2. **工作效率提升（6個月內，選擇性）**
   - ✅ AI Agent幫助節省資料分析時間（例如：原本需要30分鐘的分析，AI 5分鐘完成）
   - ✅ 可以用自然語言查詢資料（不需要學習Airtable的filter語法）
   - ✅ 複雜查詢不再受限（JOIN、聚合、時間序列分析等）

3. **成本控制**
   - ✅ Zeabur成本控制在 $7-12/月
   - ✅ Airtable費用維持不變（短期內）
   - ✅ 未來有選擇權：如果Airtable漲價，可以考慮遷移

4. **時間彈性**
   - ✅ 專案可以隨時暫停或放慢（不影響日常工作）
   - ✅ Phase 2不是強制性的（可以視工作負荷決定）
   - ✅ 沒有「必須遷移」的壓力

### Technical Success（技術成功）

**Phase 1 技術成功標準（0-3個月）：**

1. **同步可靠性**
   - ✅ 每小時自動同步成功率 ≥ 99%
   - ✅ 失敗時自動重試和告警（Email通知）
   - ✅ 同步歷史可追蹤（知道何時同步、同步了多少筆）

2. **資料完整性**
   - ✅ 20,000筆資料100%成功同步
   - ✅ Rich text內容完整保留（繁體中文、特殊符號、emoji無亂碼）
   - ✅ 連結資料正確解析和儲存

3. **AI/Claude Code整合能力**（這是關鍵！）
   - ✅ Claude Code可以直接讀取Supabase資料（使用PostgreSQL連接）
   - ✅ 支援複雜SQL查詢（JOIN、聚合、子查詢等）
   - ✅ 查詢效能可接受（< 2秒回應時間，95百分位）
   - ✅ 可以用AI工具（Claude API、OpenAI API）透過SQL查詢資料

4. **系統穩定性**
   - ✅ Airtable和100個自動化流程完全不受影響
   - ✅ Supabase失敗不影響正常工作（影子系統）
   - ✅ 部署在Zeabur穩定運行（99%+ uptime）

**Phase 2 技術成功標準（3-6個月，選擇性）：**

5. **AI Agent基礎設施**
   - ✅ 建立AI Agent與Supabase的連接模式（範例程式碼）
   - ✅ 測試不同AI工具的整合（Claude API、OpenAI API、本地模型）
   - ✅ 建立簡單的AI查詢介面（可以是CLI、Web UI或Slack Bot）

6. **效能優化**
   - ✅ 針對AI Agent常用查詢建立索引
   - ✅ 查詢效能監控和優化
   - ✅ 支援並發AI查詢（多個Agent同時存取）

### Measurable Outcomes（可衡量成果）

**3個月後（Phase 1完成）：**

| 指標 | 目標 | 驗證方式 |
|------|------|----------|
| 同步成功率 | ≥ 99% | 同步日誌記錄 |
| 資料完整性 | 100% | 隨機抽樣驗證 |
| Claude Code整合 | 成功 | 至少完成1次AI分析 |
| 災難演練 | 1次成功 | 模擬Airtable當機 |
| 使用者信任度 | 建立 | 主觀感受評估 |
| 部署成本 | $7-12/月 | Zeabur帳單 |

**6個月後（Phase 2，選擇性）：**

| 指標 | 目標 | 驗證方式 |
|------|------|----------|
| AI Agent工作流程 | ≥ 1個 | 實際運行中的Agent |
| AI查詢效能 | < 2秒 | 效能監控 |
| 時間節省 | 可衡量 | 對比手動分析時間 |
| 流程遷移（選擇性） | 0-10個 | 視工作負荷決定 |

## Product Scope

### MVP - Minimum Viable Product（Phase 1，0-3個月）

**核心功能（必需）：**

1. **Airtable → Supabase自動同步**
   - 每小時自動執行
   - 處理20,000筆資料
   - Rich text和連結完整保留
   - UTF-8編碼正確處理

2. **資料完整性驗證**
   - 同步後自動驗證筆數
   - 隨機抽樣5%內容檢查
   - 異常時Email告警

3. **基本監控和告警**
   - 同步成功/失敗狀態記錄
   - Email告警（連續3次失敗）
   - 簡單的日誌系統

4. **Claude Code整合準備**
   - Supabase提供PostgreSQL連接
   - 支援SQL查詢
   - 基本的索引配置

**交付標準：**
- ✅ 部署到Zeabur並穩定運行1個月
- ✅ 至少完成1次成功的災難演練
- ✅ 至少完成1次Claude Code資料分析

**不包含在MVP：**
- ❌ 雙向同步（只做單向）
- ❌ 自動化流程遷移（Phase 2）
- ❌ 自建UI（使用Supabase Table Editor）
- ❌ 複雜的監控儀表板（只有基本日誌）

### Growth Features（Phase 2，3-6個月，選擇性）

**如果時間和資源允許，可以添加：**

1. **AI Agent工作流程**（優先）
   - 建立Claude/GPT與Supabase的整合
   - 開發簡單的AI查詢介面
   - 測試不同AI工具的效果

2. **部分流程遷移**（次要）
   - 選擇5-10個「讀取」流程
   - 逐步遷移到Supabase API
   - 驗證穩定性（30天運行期）

3. **效能優化**
   - 針對AI查詢建立索引
   - 查詢效能監控
   - 並發處理優化

---

## Feature: AI Customer Interaction Query Interface

此功能旨在建立一個智能介面，讓使用者能透過自然語言或結構化查詢，快速獲取客戶歷史互動的深度分析。

### 1. 使用場景 (User Scenarios)

- **Priority 1: 深度分析工作台 (情境 B)**
  - 使用者在電腦前進行複雜決策前，需要 AI 統整特定客戶的歷史脈絡。
- **Priority 2: 隨身小幫手 (情境 A)**
  - 會面客戶前，透過行動裝置快速獲取關鍵摘要。
- **未來擴展：自動化推播 (情境 C)**
  - 每日定時發送關鍵客戶追蹤摘要，實現「資訊找人」。

### 2. 介面規格 (UI/UX Specs)

- **呈現形態**：彈出式互動對話視窗 (Floating Interactive Popup)。
- **首頁佈局 (Home Page Layout)**：
  - **上方區域**：核心查詢輸入框（客戶名稱、國家、查詢事項）。增加 **「國家篩選 (Country Filter)」** 功能，優化多使用者下的區域管理。
  - **下方區域**：**「今日建議聯繫名單」**，顯示前 10 筆（或更少）由 Level 3 推薦的客戶名單。
    - **顯示內容 (Mixed Mode)**：
      - **數據脈絡**：顯示該客戶最後一筆 `update_content` 的摘要與國家資訊。
      - **行動理由**：顯示 AI 判斷「為什麼此刻值得聯繫」的具體建議原因（例如：需求轉向偵測）。
- **輸入欄位**：
  - (a) **客戶名稱** (必填)
  - (b) **國家** (可選)
  - (c) **欲查詢事項/問題** (必填)
- **行動追蹤與待辦管理 (Action Tracking)**：
  - **狀態標記**：針對 AI 推薦的熱絡度聯繫名單，提供「已處理/未處理」標註功能。
  - **決策回饋**：記錄使用者的處理結果，作為未來 AI 優化推薦邏輯的學習數據。
- **同步控制管理**：
  - 提供 **「Sync Now」立即同步按鈕**，允許使用者手動觸發即時同步。
- **安全性**：
  - 介面受 **Email 與密碼認證 (Email/Password Authentication)** 保護。
  - 支援 **多使用者登入 (Multi-user Support)**，為未來的權限管理與個人化記錄奠定基礎。

### 3. 技術與資料邏輯 (Technical Logic)

- **主要資料源**：嚴格限定使用 Supabase 中的 `update_content` 欄位進行回答與總結。
- **語言處理**：
  - AI 必須依據使用者提出問題的「語系」進行回答 (同一語系回覆)。
  - 即使資料源包含多種語言，回覆應符合使用者直覺。
- **同步邏輯 (Synchronized Logic)**：
  - **增量同步 (Incremental Sync)**：嚴格執行增量模式，僅抓取上次同步後發生異動的資料。
  - **斷點續傳 (Checkpointing)**：具備斷點續傳能力，若同步失敗，下次啟動將自動從失敗點繼續，不從頭開始。
- **主題分群邏輯**：
  - 在 `summary_cn` 欄位中，若內容相同但尾綴包含 "part.1", "part.2" 等標記，AI 必須將其視為「同一個主題」進行內容彙整，不得拆分。
- **回答準確度 (Precision)**：
  - AI 的回答必須包含 **引用 (Citation)**，註明其判斷與結論是基於哪一段原始資料，以供使用者核實。

### 4. 智能等級 (Intelligence Levels)

- **Level 1 (檢索)**：透過關鍵字與語義搜尋精確找出歷史記錄。
- **Level 2 (自動化效益)**：
  - **自動化郵件草稿 (Automated Email Drafts)**：根據查詢結果與洞察，自動生成後續聯繫的郵件草稿。
  - **語言與格式**：
    - 郵件內容固定為 **英文 (English)**，語氣為「老朋友商務風」。
    - **必須在英文草稿下方附上「繁體中文翻譯」**，方便使用者核對與理解內容。
- **Level 3 (洞察與推論)**：
  - **熱絡度分析與推薦**：AI 定期分析客戶的互動頻率與內容權重，自動推薦「今日需優先聯繫」的客戶清單。
    - **優先權重判斷**：關於 **「設備規格 (Machine Specs)」** 的熱烈討論與 **「設備報價 (Machine Quote)」** 的需求列為最高優先權；純粹的「零件報價 (Parts Quote)」則調降優先級。
  - **資訊一致性分析**：AI 比對跨時間點的記錄，自動偵測客戶說法是否矛盾或需求是否發生重大轉向，並主動提醒使用者。

---

## Innovation & Novel Patterns

### 1. 偵測到的創新領域 (Detected Innovation Areas)

- **從「備份」到「預測」的範式轉移**：本專案不只是單純的資料備份，而是首創將 20,000 筆靜態歷史記錄轉化為具備「主動推薦」能力的專家系統。
- **挑戰傳統假設**：本專案挑戰了「只有人類能透過複雜資料庫進行判斷」的假設，引入 AI 進行深層的語義分析（情緒、一致性、熱絡度）。
- **AI 輔助決策介面**：透過彈出式視窗實現「即席問題查詢」與「自動郵件生成」的無縫整合，縮短從資料發現到行動執行的距離。

### 2. 驗證方法 (Validation Approach)

- **使用者體驗評分制 (User Rating System)**：
  - 每一次 AI 生成的洞察（熱絡度推薦或一致性警示）後，系統將提供評分機制（例如 1-5 星或讚/踩）。
  - **成功定義**：使用者認為 AI 洞察「精準且具參考價值」的比率需 > 60%。
- **專家基準對比 (Expert Benchmarking)**：
  - 透過「測試運行」模式，對比 AI 的判斷與使用者以往的「自行判斷」經驗，識別 AI 是否能發現人類遺漏的死角。

### 3. 風險緩解 (Risk Mitigation)

- **AI 幻覺與引用機制**：為避免 AI 錯誤解讀內容，所有洞察必須強制包含「原始記錄引用 (Citation)」。若無明確資料支撐，AI 應拒絕給出特定結論。
- **人類最終決策**：AI 僅提供推薦清單與郵件草稿，所有的最終聯繫行為必須經過使用者（Liaosanyi）的審閱與確認。
4. **監控增強**：
  - **同步失敗 UI 告警**：若連續 3 次增量同步失敗，除 Email 告警外，系統必須在首頁顯眼處顯示「紅色警告標示」，通知所有使用者資料可能非最新。
  - 簡單的Web儀表板
  - 同步狀態可視化
  - 更詳細的日誌

**決策點：**
- 工作時間充足 → 執行Phase 2
- 工作繁忙 → 維持Phase 1（完全可接受）

### Vision（Phase 3，6個月後，遠期願景）

**長期願景（不急於實現）：**

1. **AI Agent生態系統**
   - 多個AI Agent協同工作
   - 自動化資料分析和洞察生成
   - 自然語言資料互動

2. **完全資料自主**
   - 如果建立合適的UI → 考慮完全脫離Airtable
   - 如果UI成本太高 → 維持混合模式
   - 根據實際需求靈活決策

3. **進階整合**
   - 與其他工具整合（Metabase、Grafana等）
   - 建立自定義分析儀表板
   - 資料視覺化和報表

**重要原則：**
- 不急於求成，時間站在我們這邊
- 每個階段都創造獨立價值
- 可以隨時暫停或調整
- 務實決策，不過度承諾

## User Journeys

### 旅程1：Liaosanyi - 日常工作者（無縫運作）

這是一個平凡的週二早晨，Liaosanyi像往常一樣打開Airtable，開始處理客戶資料。20,000筆客戶記錄整齊地排列著，100個Make.com和n8n自動化流程每15分鐘默默運行，一切都如常。

她並不知道，在背景中，Supabase正在每小時靜靜地複製所有資料。沒有彈窗、沒有延遲、沒有任何干擾。就像有一位隱形助手，默默地為她的資料建立了一個安全網。

三個月後的某天，她突然想起「對了，那個同步系統應該在運行吧？」她檢查了一下Email，看到系統每週發送的狀態報告：「同步成功率：99.2%，最後同步：1小時前，資料筆數：20,000」。她微微一笑，關閉Email，繼續工作。

**這個旅程揭示的需求：**
- 完全透明的背景同步（零干擾）
- 定期狀態報告（建立信任）
- Airtable和自動化流程完全不受影響
- 簡單的「一切正常」確認機制

### 旅程2：Liaosanyi - AI分析師（「值得了」的時刻）

已經是Phase 1的第10週，Liaosanyi終於有時間嘗試她一直想做的事情：用AI分析客戶資料。

以前，她只能在Airtable的介面裡點擊filter、建立view、手動統計。想要找出「過去3個月互動最頻繁但還沒成交的前20個客戶」這種複雜查詢，需要花30分鐘手動操作。

但今天不一樣。她打開應用程式的 AI 視窗，輸入一個簡單的指令：「分析過去3個月互動頻率最高但尚未成交的客戶，並給我洞察為什麼他們還沒成交。」

5分鐘後，Gemini 不僅列出了客戶名單，還分析了他們的互動模式、常見問題、以及建議的跟進策略。這種分析，在Airtable裡根本做不到。

她盯著螢幕，突然明白了：「這就是資料自由的感覺。我不再被工具限制，我可以問任何問題。」那一刻，她知道這3個月的投入完全值得了。

**這個旅程揭示的需求：**
-   Supabase提供標準SQL查詢介面
-   Gemini Code/AI工具可以直接連接PostgreSQL
-   查詢效能足夠快（< 2秒）
-   支援複雜查詢（JOIN、聚合、時間序列分析）
-   資料結構清晰，AI工具能理解

### 旅程3：Liaosanyi - 系統管理員（信任建立）

Phase 1的第4週，週六早上，Liaosanyi收到一封Email告警：「警告：Supabase同步連續3次失敗」。

她的心跳加速。這是系統第一次出問題。她打開Email查看詳細資訊：

```
失敗時間：03:00, 04:00, 05:00
錯誤訊息：Airtable API rate limit exceeded
已同步筆數：15,230 / 20,000
```

她鬆了一口氣。Airtable還在正常運作，100個自動化流程也都沒問題。只是同步程式遇到了API速率限制。

她查看了系統日誌，發現程式在06:00自動重試時成功了。系統已經自我修復。她記下這個問題：「可能需要調整同步速度」，然後繼續享受她的週末。

到了第8週，系統已經連續4週沒有任何失敗。她開始真正信任這個備份系統。

**這個旅程揭示的需求：**
-   即時Email告警（失敗時立即通知）
-   清楚的錯誤訊息和日誌
-   自動重試機制
-   同步狀態和進度可追蹤
-   失敗不影響Airtable正常運作
-   定期「一切正常」的狀態報告

### 旅程4：Liaosanyi - AI Agent開發者（Phase 2願景）

Phase 2的第2個月，Liaosanyi終於有時間實現她的願景：建立一個AI Agent，讓它自動分析客戶資料並生成每週洞察報告。

在Airtable時代，這根本不可能。Airtable的API太受限，無法支援這種複雜的AI工作流程。

但現在，她有了Supabase。她開始建立她的第一個AI Agent：

1.  **設定每週定時觸發**（週一早上9點）
2.  **AI Agent執行SQL查詢**：
    -   上週新增的客戶
    -   互動頻率變化趨勢
    -   潛在流失客戶
    -   成交機會分析

3.  **AI生成洞察報告**：
    -   用自然語言總結資料
    -   發現異常模式
    -   提供行動建議

4.  **自動發送到Slack**

第一次運行時，她緊張地等待。9點整，Slack收到了報告：

> 📊 **週報 - 2026/01/06**
>
> **關鍵洞察：**
> -   上週新增15個客戶，其中8個來自推薦
> -   客戶A的互動頻率驟降70%，建議主動聯繫
> -   發現模式：週四晚上的Email回覆率最高
>
> **建議行動：**
> 1.  聯繫客戶A（可能流失）
> 2.  調整Email發送時間到週四晚上
> 3.  推薦來源效果好，考慮強化推薦機制

她看著這份報告，意識到AI Agent在5分鐘內完成了她以前需要2小時才能做完的分析。更重要的是，這種分析現在是「自動化」的，每週都會執行。

「這才是我想要的未來。」她想。

**這個旅程揭示的需求：**
-   AI Agent可以定時觸發查詢
-   支援複雜的SQL查詢
-   API效能支援AI工具的並發查詢
-   查詢結果格式化（JSON、CSV等）
-   範例程式碼和文檔（如何連接Supabase）
-   針對AI查詢優化的索引

### 旅程5：AI Agent（技術性使用者，自動化分析）

每週一早上9點，AI Agent「Weekly Insight Bot」準時醒來。它的任務很明確：分析Liaosanyi的客戶資料，生成洞察報告。

它首先連接到Supabase PostgreSQL資料庫，執行第一個查詢：

```sql
SELECT customer_name, last_interaction_date, interaction_count
FROM customers
WHERE last_interaction_date > NOW() - INTERVAL '7 days'
ORDER BY interaction_count DESC
LIMIT 20;
```

**0.8秒後**，結果返回。20個最活躍的客戶。

接著執行第二個查詢，尋找潛在流失客戶：

```sql
SELECT customer_name,
       AVG(interaction_count) OVER (PARTITION BY customer_name) as avg_interaction,
       interaction_count as this_week_interaction
FROM customers
WHERE interaction_count < (AVG(interaction_count) * 0.5);
```

**1.2秒後**，找到3個互動頻率驟降的客戶。

AI Agent將這些資料送入 Gemini API，請求生成分析報告。Gemini 處理資料，識別模式，提供建議。

**5分鐘後**，完整的洞察報告生成並發送到Slack。整個過程完全自動化，Liaosanyi甚至不需要打開電腦。

**這個旅程揭示的需求：**
- 支援複雜SQL（JOIN、窗口函數、子查詢）
- 並發查詢支援（多個Agent同時存取）
- 資料索引優化（常用欄位）
- API穩定性（99%+ uptime）

### Journey Requirements Summary

這5個旅程揭示了系統需要的核心能力：

**Phase 1 核心能力：**

1. **背景同步系統**
   - 每小時自動執行
   - 完全透明（零干擾）
   - 自動重試和錯誤處理

2. **監控和告警**
   - Email即時告警
   - 清楚的錯誤訊息和日誌
   - 定期狀態報告
   - 同步歷史可追蹤

3. **資料完整性**
   - 20,000筆資料100%同步
   - Rich text和連結完整保留
   - UTF-8編碼正確處理

4. **AI/Claude Code整合**
   - PostgreSQL標準連接
   - 複雜SQL查詢支援
   - 查詢效能 < 2秒
   - 資料結構清晰

**Phase 2 進階能力（選擇性）：**

5. **AI Agent基礎設施**
   - 定時觸發查詢
   - 並發查詢支援
   - API穩定性保證
   - 範例程式碼和文檔

6. **效能優化**
   - 針對AI查詢的索引
   - 查詢效能監控
   - 並發處理優化
